{% macro product_card(product) %}
<div class="card h-100 shadow-sm border-0">
    <!-- === IMAGE === -->
    {% if product.image_bytes %}
        <img src="data:image/jpeg;base64,{{ product.image_bytes|b64encode }}"
             class="card-img-top" alt="{{ product.name }}" style="height:200px; object-fit:cover;">
    {% else %}
        <div class="d-flex align-items-center justify-content-center bg-light"
             style="height:200px;">
            <i class="fa fa-image fa-3x text-muted"></i>
        </div>
    {% endif %}

    <!-- === BODY === -->
    <div class="card-body d-flex flex-column">
        <h5 class="card-title">{{ product.name }}</h5>
        <p class="card-text small flex-grow-1">
            {% if product.description %}
                {% if product.description|length > 100 %}
                    {{ product.description[:100] }}...
                {% else %}
                    {{ product.description }}
                {% endif %}
            {% endif %}
        </p>

        <ul class="list-unstyled mt-auto mb-2">
            <li><strong>Category:</strong> {{ product.category }}</li>
            <li><strong>Size:</strong> {{ product.size }}</li>
            <li><strong>Price:</strong> R {{ "%.2f"|format(product.price) }}</li>
            <li>
                <strong>Stock:</strong>
                {% if product.stock > 0 %}
                    <span class="badge bg-success">{{ product.stock }} available</span>
                {% else %}
                    <span class="badge bg-danger">Out of stock</span>
                {% endif %}
            </li>
        </ul>

        <!-- â™¥ WISH-LIST (same style as catalogue) -->
        <div class="mb-2">
            <button class="btn btn-sm btn-outline-danger favourite-btn"
                    data-id="{{ product.id }}" 
                    data-csrf="{{ csrf_token() }}"
                    title="Add to wishlist">
                <i class="fa fa-heart-o"></i>
            </button>
        </div>

        <!-- === ACTION BUTTONS (same colours & borders) === -->
        <div class="d-flex justify-content-between align-items-center">
            <a href="{{ url_for('products.details', id=product.id) }}"
               class="btn btn-outline-primary btn-sm border-inner">
                View
            </a>
            {% if current_user.is_authenticated and current_user.is_admin %}
                <a href="{{ url_for('products.edit', id=product.id) }}"
                   class="btn btn-primary btn-sm border-inner">
                    Edit
                </a>
            {% endif %}
        </div>
    </div>
</div>
{% endmacro %}
\

<!-- === AJAX TOGGLE (one snippet for whole page) === -->
<script>
    $(".favourite-btn").on("click", function () {
        var btn = $(this);
        var id  = btn.data("id");
        var csrfToken = btn.data("csrf");
        
        $.ajax({
            url: "{{ url_for('favorites.toggle', product_id=0) }}".slice(0, -1) + id,
            type: 'POST',
            headers: {
                'X-CSRFToken': csrfToken
            },
            success: function(res) {
                btn.find("i").toggleClass("fa-heart-o", !res.favourited)
                             .toggleClass("fa-heart", res.favourited);
            },
            error: function(xhr, status, error) {
                console.error('Error toggling favorite:', error);
            }
        });
    });
</script>